/*! For license information please see 280.js.LICENSE.txt */
"use strict";(self.webpackChunkmetavox=self.webpackChunkmetavox||[]).push([[280],{49280:(t,e,a)=>{a.r(e),a.d(e,{default:()=>z});var n=function(){var t=this,e=t._self._c;return t.show?e("NcModal",{attrs:{name:t.t("metavox","Edit Metadata"),size:"large"},on:{close:t.close}},[e("div",{staticClass:"bulk-metadata-modal"},[e("h2",{staticClass:"modal-title"},[t._v("\n\t\t\t"+t._s(t.t("metavox","Edit Metadata"))+"\n\t\t")]),t._v(" "),e("p",{staticClass:"modal-description"},[t._v("\n\t\t\t"+t._s(t.t("metavox","Edit metadata for {count} selected files",{count:t.files.length}))+"\n\t\t")]),t._v(" "),e("div",{staticClass:"selected-files"},[e("div",{staticClass:"selected-files-header"},[e("h3",[t._v(t._s(t.t("metavox","Selected Files")))]),t._v(" "),!t.loadingStatus&&t.filesWithMetadata>0?e("span",{staticClass:"metadata-summary"},[t._v("\n\t\t\t\t\t"+t._s(t.t("metavox","{count} of {total} have metadata",{count:t.filesWithMetadata,total:t.files.length}))+"\n\t\t\t\t")]):t._e()]),t._v(" "),e("ul",{staticClass:"file-list"},t._l(t.files,function(a){return e("li",{key:a.fileid,staticClass:"file-item"},[e("FileIcon",{attrs:{size:20}}),t._v(" "),e("span",{staticClass:"file-name"},[t._v(t._s(a.basename))]),t._v(" "),void 0!==t.fileMetadataStatus[a.fileid]?e("span",{staticClass:"metadata-indicator",class:{"has-metadata":t.fileMetadataStatus[a.fileid]>0}},[t._v("\n\t\t\t\t\t\t"+t._s(t.fileMetadataStatus[a.fileid]>0?t.fileMetadataStatus[a.fileid]:"0")+"\n\t\t\t\t\t")]):t._e()],1)}),0)]),t._v(" "),e("div",{staticClass:"merge-strategy"},[e("h3",[t._v(t._s(t.t("metavox","Update Mode")))]),t._v(" "),e("NcCheckboxRadioSwitch",{attrs:{checked:"overwrite"===t.mergeStrategy,type:"radio",name:"merge-strategy"},on:{"update:checked":function(e){t.mergeStrategy="overwrite"}}},[t._v("\n\t\t\t\t"+t._s(t.t("metavox","Overwrite existing values"))+"\n\t\t\t")]),t._v(" "),e("NcCheckboxRadioSwitch",{attrs:{checked:"fill-empty"===t.mergeStrategy,type:"radio",name:"merge-strategy"},on:{"update:checked":function(e){t.mergeStrategy="fill-empty"}}},[t._v("\n\t\t\t\t"+t._s(t.t("metavox","Only fill empty fields"))+"\n\t\t\t")])],1),t._v(" "),t.loading?e("div",{staticClass:"loading-state"},[e("NcLoadingIcon",{attrs:{size:32}}),t._v(" "),e("p",[t._v(t._s(t.t("metavox","Loading metadata fields...")))])],1):t.fields.length>0?e("div",{staticClass:"metadata-section"},[e("h3",[t._v(t._s(t.t("metavox","Metadata")))]),t._v(" "),e("MetadataForm",{attrs:{fields:t.fields,values:t.metadata,"select-values":t.selectValues,"multi-select-values":t.multiSelectValues,"select-key":t.selectKey},on:{update:t.handleFieldUpdate}})],1):e("div",{staticClass:"no-fields"},[e("p",[t._v(t._s(t.t("metavox","No metadata fields available for these files.")))])]),t._v(" "),e("div",{staticClass:"modal-actions"},[e("NcButton",{attrs:{type:"tertiary"},on:{click:t.close}},[t._v("\n\t\t\t\t"+t._s(t.t("metavox","Cancel"))+"\n\t\t\t")]),t._v(" "),e("NcButton",{attrs:{type:"primary",disabled:t.saving||!t.hasChanges},on:{click:t.save},scopedSlots:t._u([{key:"icon",fn:function(){return[t.saving?e("NcLoadingIcon",{attrs:{size:20}}):t._e()]},proxy:!0}],null,!1,177630579)},[t._v("\n\t\t\t\t"+t._s(t.saving?t.t("metavox","Saving..."):t.t("metavox","Save"))+"\n\t\t\t")])],1)])]):t._e()};n._withStripped=!0;var r=a(76333),i=a(93106),o=a(66802),l=a(63814),s=a(99788),c=a(48753);function d(t){return d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},d(t)}function f(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),a.push.apply(a,n)}return a}function u(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?f(Object(a),!0).forEach(function(e){p(t,e,a[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):f(Object(a)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))})}return t}function p(t,e,a){return(e=function(t){var e=function(t){if("object"!=d(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var a=e.call(t,"string");if("object"!=d(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==d(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function v(){var t,e,a="function"==typeof Symbol?Symbol:{},n=a.iterator||"@@iterator",r=a.toStringTag||"@@toStringTag";function i(a,n,r,i){var s=n&&n.prototype instanceof l?n:l,c=Object.create(s.prototype);return m(c,"_invoke",function(a,n,r){var i,l,s,c=0,d=r||[],f=!1,u={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,a){return i=e,l=0,s=t,u.n=a,o}};function p(a,n){for(l=a,s=n,e=0;!f&&c&&!r&&e<d.length;e++){var r,i=d[e],p=u.p,v=i[2];a>3?(r=v===n)&&(s=i[(l=i[4])?5:(l=3,3)],i[4]=i[5]=t):i[0]<=p&&((r=a<2&&p<i[1])?(l=0,u.v=n,u.n=i[1]):p<v&&(r=a<3||i[0]>n||n>v)&&(i[4]=a,i[5]=n,u.n=v,l=0))}if(r||a>1)return o;throw f=!0,n}return function(r,d,v){if(c>1)throw TypeError("Generator is already running");for(f&&1===d&&p(d,v),l=d,s=v;(e=l<2?t:s)||!f;){i||(l?l<3?(l>1&&(u.n=-1),p(l,s)):u.n=s:u.v=s);try{if(c=2,i){if(l||(r="next"),e=i[r]){if(!(e=e.call(i,s)))throw TypeError("iterator result is not an object");if(!e.done)return e;s=e.value,l<2&&(l=0)}else 1===l&&(e=i.return)&&e.call(i),l<2&&(s=TypeError("The iterator does not provide a '"+r+"' method"),l=1);i=t}else if((e=(f=u.n<0)?s:a.call(n,u))!==o)break}catch(e){i=t,l=1,s=e}finally{c=1}}return{value:e,done:f}}}(a,r,i),!0),c}var o={};function l(){}function s(){}function c(){}e=Object.getPrototypeOf;var d=[][n]?e(e([][n]())):(m(e={},n,function(){return this}),e),f=c.prototype=l.prototype=Object.create(d);function u(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,c):(t.__proto__=c,m(t,r,"GeneratorFunction")),t.prototype=Object.create(f),t}return s.prototype=c,m(f,"constructor",c),m(c,"constructor",s),s.displayName="GeneratorFunction",m(c,r,"GeneratorFunction"),m(f),m(f,r,"Generator"),m(f,n,function(){return this}),m(f,"toString",function(){return"[object Generator]"}),(v=function(){return{w:i,m:u}})()}function m(t,e,a,n){var r=Object.defineProperty;try{r({},"",{})}catch(t){r=0}m=function(t,e,a,n){function i(e,a){m(t,e,function(t){return this._invoke(e,a,t)})}e?r?r(t,e,{value:a,enumerable:!n,configurable:!n,writable:!n}):t[e]=a:(i("next",0),i("throw",1),i("return",2))},m(t,e,a,n)}function g(t,e){var a="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!a){if(Array.isArray(t)||(a=function(t,e){if(t){if("string"==typeof t)return h(t,e);var a={}.toString.call(t).slice(8,-1);return"Object"===a&&t.constructor&&(a=t.constructor.name),"Map"===a||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?h(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){a&&(t=a);var n=0,r=function(){};return{s:r,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,l=!1;return{s:function(){a=a.call(t)},n:function(){var t=a.next();return o=t.done,t},e:function(t){l=!0,i=t},f:function(){try{o||null==a.return||a.return()}finally{if(l)throw i}}}}function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,n=Array(e);a<e;a++)n[a]=t[a];return n}function y(t,e,a,n,r,i,o){try{var l=t[i](o),s=l.value}catch(t){return void a(t)}l.done?e(s):Promise.resolve(s).then(n,r)}function b(t){return function(){var e=this,a=arguments;return new Promise(function(n,r){var i=t.apply(e,a);function o(t){y(i,n,r,o,l,"next",t)}function l(t){y(i,n,r,o,l,"throw",t)}o(void 0)})}}const x={name:"BulkMetadataModal",components:{NcModal:r.FH,NcButton:r.x1,NcCheckboxRadioSwitch:r.AO,NcLoadingIcon:r.ne,FileIcon:s.A,MetadataForm:c.A},props:{show:{type:Boolean,default:!1},files:{type:Array,default:function(){return[]}}},emits:["close","saved"],data:function(){return{loading:!1,saving:!1,loadingStatus:!1,fields:[],metadata:{},originalMetadata:{},mergeStrategy:"overwrite",selectValues:{},multiSelectValues:{},selectKey:0,fileMetadataStatus:{},groupfolderId:null}},computed:{hasChanges:function(){return JSON.stringify(this.metadata)!==JSON.stringify(this.originalMetadata)},filesWithMetadata:function(){return Object.values(this.fileMetadataStatus).filter(function(t){return t>0}).length}},watch:{show:{immediate:!0,handler:function(t){t&&this.files.length>0&&this.loadFields()}}},methods:{t:function(t,e,a){if(a){var n=window.t?window.t(t,e):e;return Object.keys(a).forEach(function(t){n=n.replace("{".concat(t,"}"),a[t])}),n}return window.t?window.t(t,e):e},loadFields:function(){var t=this;return b(v().m(function e(){var a,n,r,s,c,d,f,u,p,m,h,y;return v().w(function(e){for(;;)switch(e.p=e.n){case 0:if(t.loading=!0,t.fileMetadataStatus={},e.p=1,a=t.files[0],n=a.path||a.filename||"",r=n.match(/^\/__groupfolders\/(\d+)/),t.groupfolderId=null,!r){e.n=2;break}t.groupfolderId=r[1],e.n=10;break;case 2:return e.n=3,o.Ay.get((0,l.Jv)("/apps/metavox/api/groupfolders"));case 3:s=e.v,c=s.data,d=g(c),e.p=4,d.s();case 5:if((f=d.n()).done){e.n=7;break}if(u=f.value,!n.includes("/".concat(u.mount_point,"/"))&&!n.startsWith("/".concat(u.mount_point))){e.n=6;break}return t.groupfolderId=u.id,e.a(3,7);case 6:e.n=5;break;case 7:e.n=9;break;case 8:e.p=8,h=e.v,d.e(h);case 9:return e.p=9,d.f(),e.f(9);case 10:if(!t.groupfolderId){e.n=12;break}return p=t.files[0].fileid,e.n=11,o.Ay.get((0,l.Jv)("/apps/metavox/api/groupfolders/{groupfolderId}/files/{fileId}/metadata",{groupfolderId:t.groupfolderId,fileId:p}));case 11:m=e.v,t.fields=(m.data||[]).filter(function(t){var e=t.applies_to_groupfolder;return 0===e||"0"===e||null==e}),e.n=13;break;case 12:t.fields=[];case 13:t.metadata={},t.originalMetadata={},t.fields.forEach(function(e){t.metadata[e.field_name]="",t.originalMetadata[e.field_name]=""}),t.initializeSelectValues(),t.groupfolderId&&t.fields.length>0&&t.loadMetadataStatus(),e.n=15;break;case 14:e.p=14,y=e.v,console.error("Failed to load fields:",y),(0,i.Qg)(t.t("metavox","Failed to load metadata fields"));case 15:return e.p=15,t.loading=!1,e.f(15);case 16:return e.a(2)}},e,null,[[4,8,9,10],[1,14,15,16]])}))()},loadMetadataStatus:function(){var t=this;return b(v().m(function e(){var a;return v().w(function(e){for(;;)switch(e.p=e.n){case 0:return t.loadingStatus=!0,e.p=1,a=t.files.map(function(){var e=b(v().m(function e(a){var n,r,i;return v().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,o.Ay.get((0,l.Jv)("/apps/metavox/api/groupfolders/{groupfolderId}/files/{fileId}/metadata",{groupfolderId:t.groupfolderId,fileId:a.fileid}));case 1:n=e.v,r=(n.data||[]).filter(function(t){var e=t.applies_to_groupfolder;return 0===e||"0"===e||null==e}),i=r.filter(function(t){return t.value&&""!==t.value}).length,t.$set(t.fileMetadataStatus,a.fileid,i),e.n=3;break;case 2:e.p=2,e.v,t.$set(t.fileMetadataStatus,a.fileid,0);case 3:return e.a(2)}},e,null,[[0,2]])}));return function(t){return e.apply(this,arguments)}}()),e.n=2,Promise.all(a);case 2:return e.p=2,t.loadingStatus=!1,e.f(2);case 3:return e.a(2)}},e,null,[[1,,2,3]])}))()},initializeSelectValues:function(){var t=this;this.selectValues={},this.multiSelectValues={},this.fields.forEach(function(e){"select"===e.field_type?t.selectValues[e.field_name]=null:"multiselect"!==e.field_type&&"multi_select"!==e.field_type||(t.multiSelectValues[e.field_name]=[])}),this.selectKey++},handleFieldUpdate:function(t,e){this.metadata=u(u({},this.metadata),{},p({},t,e));var a=this.fields.find(function(e){return e.field_name===t});a&&("select"===a.field_type?this.selectValues[t]=e||null:"multiselect"!==a.field_type&&"multi_select"!==a.field_type||(this.multiSelectValues[t]=e?e.split(";#"):[]))},save:function(){var t=this;return b(v().m(function e(){var a,n,r,s;return v().w(function(e){for(;;)switch(e.p=e.n){case 0:if(t.saving=!0,e.p=1,a=t.files.map(function(t){return t.fileid}),n={},Object.keys(t.metadata).forEach(function(e){""!==t.metadata[e]&&null!==t.metadata[e]&&(n[e]=t.metadata[e])}),0!==Object.keys(n).length){e.n=2;break}return(0,i.Qg)(t.t("metavox","No metadata values to save")),e.a(2);case 2:return e.n=3,o.Ay.post((0,l.Jv)("/apps/metavox/api/files/bulk-metadata"),{fileIds:a,metadata:n,mergeStrategy:t.mergeStrategy});case 3:(0,i.Te)(t.t("metavox","Metadata saved for {count} files",{count:t.files.length})),t.$emit("saved"),t.close(),e.n=5;break;case 4:e.p=4,s=e.v,console.error("Failed to save metadata:",s),(0,i.Qg)((null===(r=s.response)||void 0===r||null===(r=r.data)||void 0===r?void 0:r.error)||t.t("metavox","Failed to save metadata"));case 5:return e.p=5,t.saving=!1,e.f(5);case 6:return e.a(2)}},e,null,[[1,4,5,6]])}))()},close:function(){this.metadata={},this.originalMetadata={},this.fields=[],this.$emit("close")}}};var _=a(85072),w=a.n(_),S=a(97825),k=a.n(S),O=a(77659),j=a.n(O),M=a(55056),I=a.n(M),C=a(10540),A=a.n(C),P=a(41113),F=a.n(P),N=a(57650),E={};E.styleTagTransform=F(),E.setAttributes=I(),E.insert=j().bind(null,"head"),E.domAPI=k(),E.insertStyleElement=A(),w()(N.A,E),N.A&&N.A.locals&&N.A.locals;const z=(0,a(14486).A)(x,n,[],!1,null,"6f5e1141",null).exports},57650:(t,e,a)=>{a.d(e,{A:()=>l});var n=a(31601),r=a.n(n),i=a(76314),o=a.n(i)()(r());o.push([t.id,"\n.bulk-metadata-modal[data-v-6f5e1141] {\n\tpadding: 20px;\n\tdisplay: flex;\n\tflex-direction: column;\n\tgap: 20px;\n\tmax-height: 80vh;\n\toverflow-y: auto;\n}\n.modal-title[data-v-6f5e1141] {\n\tmargin: 0;\n\tfont-size: 20px;\n\tfont-weight: 600;\n}\n.modal-description[data-v-6f5e1141] {\n\tmargin: 0;\n\tcolor: var(--color-text-maxcontrast);\n}\n.selected-files[data-v-6f5e1141] {\n\tbackground: var(--color-background-hover);\n\tpadding: 12px;\n\tborder-radius: var(--border-radius-large);\n}\n.selected-files-header[data-v-6f5e1141] {\n\tdisplay: flex;\n\tjustify-content: space-between;\n\talign-items: center;\n\tmargin-bottom: 8px;\n}\n.selected-files-header h3[data-v-6f5e1141] {\n\tmargin: 0;\n\tfont-size: 14px;\n\tfont-weight: 600;\n}\n.metadata-summary[data-v-6f5e1141] {\n\tfont-size: 12px;\n\tcolor: var(--color-primary-element);\n\tfont-weight: 500;\n}\n.file-list[data-v-6f5e1141] {\n\tlist-style: none;\n\tmargin: 0;\n\tpadding: 0;\n\tmax-height: 120px;\n\toverflow-y: auto;\n}\n.file-item[data-v-6f5e1141] {\n\tdisplay: flex;\n\talign-items: center;\n\tgap: 8px;\n\tpadding: 4px 0;\n\tfont-size: 13px;\n}\n.file-name[data-v-6f5e1141] {\n\toverflow: hidden;\n\ttext-overflow: ellipsis;\n\twhite-space: nowrap;\n\tflex: 1;\n}\n.metadata-indicator[data-v-6f5e1141] {\n\tfont-size: 11px;\n\tpadding: 2px 6px;\n\tborder-radius: 10px;\n\tbackground: var(--color-background-dark);\n\tcolor: var(--color-text-maxcontrast);\n\tmin-width: 20px;\n\ttext-align: center;\n}\n.metadata-indicator.has-metadata[data-v-6f5e1141] {\n\tbackground: var(--color-primary-element-light);\n\tcolor: var(--color-primary-element);\n\tfont-weight: 600;\n}\n.merge-strategy[data-v-6f5e1141] {\n\tdisplay: flex;\n\tflex-direction: column;\n\tgap: 8px;\n}\n.merge-strategy h3[data-v-6f5e1141] {\n\tmargin: 0;\n\tfont-size: 14px;\n\tfont-weight: 600;\n}\n.loading-state[data-v-6f5e1141] {\n\tdisplay: flex;\n\tflex-direction: column;\n\talign-items: center;\n\tgap: 12px;\n\tpadding: 40px;\n\tcolor: var(--color-text-maxcontrast);\n}\n.metadata-section h3[data-v-6f5e1141] {\n\tmargin: 0 0 12px 0;\n\tfont-size: 14px;\n\tfont-weight: 600;\n}\n.no-fields[data-v-6f5e1141] {\n\tpadding: 20px;\n\ttext-align: center;\n\tcolor: var(--color-text-maxcontrast);\n}\n.modal-actions[data-v-6f5e1141] {\n\tdisplay: flex;\n\tjustify-content: flex-end;\n\tgap: 8px;\n\tpadding-top: 12px;\n\tborder-top: 1px solid var(--color-border);\n}\n",""]);const l=o}}]);