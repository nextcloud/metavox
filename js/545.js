/*! For license information please see 545.js.LICENSE.txt */
"use strict";(self.webpackChunkmetavox=self.webpackChunkmetavox||[]).push([[545],{5042:(t,e,n)=>{n.d(e,{A:()=>l});var a=n(31601),r=n.n(a),i=n(76314),o=n.n(i)()(r());o.push([t.id,"\n.bulk-metadata-modal[data-v-608d7e9d] {\n\tpadding: 20px;\n\tdisplay: flex;\n\tflex-direction: column;\n\tgap: 20px;\n\tmax-height: 80vh;\n\toverflow-y: auto;\n}\n.modal-title[data-v-608d7e9d] {\n\tmargin: 0;\n\tfont-size: 20px;\n\tfont-weight: 600;\n}\n.modal-description[data-v-608d7e9d] {\n\tmargin: 0;\n\tcolor: var(--color-text-maxcontrast);\n}\n.selected-files[data-v-608d7e9d] {\n\tbackground: var(--color-background-hover);\n\tpadding: 12px;\n\tborder-radius: var(--border-radius-large);\n}\n.selected-files h3[data-v-608d7e9d] {\n\tmargin: 0 0 8px 0;\n\tfont-size: 14px;\n\tfont-weight: 600;\n}\n.file-list[data-v-608d7e9d] {\n\tlist-style: none;\n\tmargin: 0;\n\tpadding: 0;\n\tmax-height: 120px;\n\toverflow-y: auto;\n}\n.file-item[data-v-608d7e9d] {\n\tdisplay: flex;\n\talign-items: center;\n\tgap: 8px;\n\tpadding: 4px 0;\n\tfont-size: 13px;\n}\n.file-name[data-v-608d7e9d] {\n\toverflow: hidden;\n\ttext-overflow: ellipsis;\n\twhite-space: nowrap;\n}\n.merge-strategy[data-v-608d7e9d] {\n\tdisplay: flex;\n\tflex-direction: column;\n\tgap: 8px;\n}\n.merge-strategy h3[data-v-608d7e9d] {\n\tmargin: 0;\n\tfont-size: 14px;\n\tfont-weight: 600;\n}\n.loading-state[data-v-608d7e9d] {\n\tdisplay: flex;\n\tflex-direction: column;\n\talign-items: center;\n\tgap: 12px;\n\tpadding: 40px;\n\tcolor: var(--color-text-maxcontrast);\n}\n.metadata-section h3[data-v-608d7e9d] {\n\tmargin: 0 0 12px 0;\n\tfont-size: 14px;\n\tfont-weight: 600;\n}\n.no-fields[data-v-608d7e9d] {\n\tpadding: 20px;\n\ttext-align: center;\n\tcolor: var(--color-text-maxcontrast);\n}\n.modal-actions[data-v-608d7e9d] {\n\tdisplay: flex;\n\tjustify-content: flex-end;\n\tgap: 8px;\n\tpadding-top: 12px;\n\tborder-top: 1px solid var(--color-border);\n}\n",""]);const l=o},93545:(t,e,n)=>{n.r(e),n.d(e,{default:()=>z});var a=function(){var t=this,e=t._self._c;return t.show?e("NcModal",{attrs:{name:t.t("metavox","Edit Metadata"),size:"large"},on:{close:t.close}},[e("div",{staticClass:"bulk-metadata-modal"},[e("h2",{staticClass:"modal-title"},[t._v("\n\t\t\t"+t._s(t.t("metavox","Edit Metadata"))+"\n\t\t")]),t._v(" "),e("p",{staticClass:"modal-description"},[t._v("\n\t\t\t"+t._s(t.t("metavox","Edit metadata for {count} selected files",{count:t.files.length}))+"\n\t\t")]),t._v(" "),e("div",{staticClass:"selected-files"},[e("h3",[t._v(t._s(t.t("metavox","Selected Files")))]),t._v(" "),e("ul",{staticClass:"file-list"},t._l(t.files,function(n){return e("li",{key:n.fileid,staticClass:"file-item"},[e("FileIcon",{attrs:{size:20}}),t._v(" "),e("span",{staticClass:"file-name"},[t._v(t._s(n.basename))])],1)}),0)]),t._v(" "),e("div",{staticClass:"merge-strategy"},[e("h3",[t._v(t._s(t.t("metavox","Update Mode")))]),t._v(" "),e("NcCheckboxRadioSwitch",{attrs:{checked:"overwrite"===t.mergeStrategy,type:"radio",name:"merge-strategy"},on:{"update:checked":function(e){t.mergeStrategy="overwrite"}}},[t._v("\n\t\t\t\t"+t._s(t.t("metavox","Overwrite existing values"))+"\n\t\t\t")]),t._v(" "),e("NcCheckboxRadioSwitch",{attrs:{checked:"fill-empty"===t.mergeStrategy,type:"radio",name:"merge-strategy"},on:{"update:checked":function(e){t.mergeStrategy="fill-empty"}}},[t._v("\n\t\t\t\t"+t._s(t.t("metavox","Only fill empty fields"))+"\n\t\t\t")])],1),t._v(" "),t.loading?e("div",{staticClass:"loading-state"},[e("NcLoadingIcon",{attrs:{size:32}}),t._v(" "),e("p",[t._v(t._s(t.t("metavox","Loading metadata fields...")))])],1):t.fields.length>0?e("div",{staticClass:"metadata-section"},[e("h3",[t._v(t._s(t.t("metavox","Metadata")))]),t._v(" "),e("MetadataForm",{attrs:{fields:t.fields,values:t.metadata,"select-values":t.selectValues,"multi-select-values":t.multiSelectValues,"select-key":t.selectKey},on:{update:t.handleFieldUpdate}})],1):e("div",{staticClass:"no-fields"},[e("p",[t._v(t._s(t.t("metavox","No metadata fields available for these files.")))])]),t._v(" "),e("div",{staticClass:"modal-actions"},[e("NcButton",{attrs:{type:"tertiary"},on:{click:t.close}},[t._v("\n\t\t\t\t"+t._s(t.t("metavox","Cancel"))+"\n\t\t\t")]),t._v(" "),e("NcButton",{attrs:{type:"primary",disabled:t.saving||!t.hasChanges},on:{click:t.save},scopedSlots:t._u([{key:"icon",fn:function(){return[t.saving?e("NcLoadingIcon",{attrs:{size:20}}):t._e()]},proxy:!0}],null,!1,177630579)},[t._v("\n\t\t\t\t"+t._s(t.saving?t.t("metavox","Saving..."):t.t("metavox","Save"))+"\n\t\t\t")])],1)])]):t._e()};a._withStripped=!0;var r=n(76333),i=n(93106),o=n(66802),l=n(63814),s=n(99788),c=n(48753);function d(t){return d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},d(t)}function u(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,a)}return n}function f(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?u(Object(n),!0).forEach(function(e){v(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function v(t,e,n){return(e=function(t){var e=function(t){if("object"!=d(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=d(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==d(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function p(){var t,e,n="function"==typeof Symbol?Symbol:{},a=n.iterator||"@@iterator",r=n.toStringTag||"@@toStringTag";function i(n,a,r,i){var s=a&&a.prototype instanceof l?a:l,c=Object.create(s.prototype);return m(c,"_invoke",function(n,a,r){var i,l,s,c=0,d=r||[],u=!1,f={p:0,n:0,v:t,a:v,f:v.bind(t,4),d:function(e,n){return i=e,l=0,s=t,f.n=n,o}};function v(n,a){for(l=n,s=a,e=0;!u&&c&&!r&&e<d.length;e++){var r,i=d[e],v=f.p,p=i[2];n>3?(r=p===a)&&(s=i[(l=i[4])?5:(l=3,3)],i[4]=i[5]=t):i[0]<=v&&((r=n<2&&v<i[1])?(l=0,f.v=a,f.n=i[1]):v<p&&(r=n<3||i[0]>a||a>p)&&(i[4]=n,i[5]=a,f.n=p,l=0))}if(r||n>1)return o;throw u=!0,a}return function(r,d,p){if(c>1)throw TypeError("Generator is already running");for(u&&1===d&&v(d,p),l=d,s=p;(e=l<2?t:s)||!u;){i||(l?l<3?(l>1&&(f.n=-1),v(l,s)):f.n=s:f.v=s);try{if(c=2,i){if(l||(r="next"),e=i[r]){if(!(e=e.call(i,s)))throw TypeError("iterator result is not an object");if(!e.done)return e;s=e.value,l<2&&(l=0)}else 1===l&&(e=i.return)&&e.call(i),l<2&&(s=TypeError("The iterator does not provide a '"+r+"' method"),l=1);i=t}else if((e=(u=f.n<0)?s:n.call(a,f))!==o)break}catch(e){i=t,l=1,s=e}finally{c=1}}return{value:e,done:u}}}(n,r,i),!0),c}var o={};function l(){}function s(){}function c(){}e=Object.getPrototypeOf;var d=[][a]?e(e([][a]())):(m(e={},a,function(){return this}),e),u=c.prototype=l.prototype=Object.create(d);function f(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,c):(t.__proto__=c,m(t,r,"GeneratorFunction")),t.prototype=Object.create(u),t}return s.prototype=c,m(u,"constructor",c),m(c,"constructor",s),s.displayName="GeneratorFunction",m(c,r,"GeneratorFunction"),m(u),m(u,r,"Generator"),m(u,a,function(){return this}),m(u,"toString",function(){return"[object Generator]"}),(p=function(){return{w:i,m:f}})()}function m(t,e,n,a){var r=Object.defineProperty;try{r({},"",{})}catch(t){r=0}m=function(t,e,n,a){function i(e,n){m(t,e,function(t){return this._invoke(e,n,t)})}e?r?r(t,e,{value:n,enumerable:!a,configurable:!a,writable:!a}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},m(t,e,n,a)}function y(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return g(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?g(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var a=0,r=function(){};return{s:r,n:function(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,l=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return o=t.done,t},e:function(t){l=!0,i=t},f:function(){try{o||null==n.return||n.return()}finally{if(l)throw i}}}}function g(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=Array(e);n<e;n++)a[n]=t[n];return a}function h(t,e,n,a,r,i,o){try{var l=t[i](o),s=l.value}catch(t){return void n(t)}l.done?e(s):Promise.resolve(s).then(a,r)}function b(t){return function(){var e=this,n=arguments;return new Promise(function(a,r){var i=t.apply(e,n);function o(t){h(i,a,r,o,l,"next",t)}function l(t){h(i,a,r,o,l,"throw",t)}o(void 0)})}}const x={name:"BulkMetadataModal",components:{NcModal:r.FH,NcButton:r.x1,NcCheckboxRadioSwitch:r.AO,NcLoadingIcon:r.ne,FileIcon:s.A,MetadataForm:c.A},props:{show:{type:Boolean,default:!1},files:{type:Array,default:function(){return[]}}},emits:["close","saved"],data:function(){return{loading:!1,saving:!1,fields:[],metadata:{},originalMetadata:{},mergeStrategy:"overwrite",selectValues:{},multiSelectValues:{},selectKey:0}},computed:{hasChanges:function(){return JSON.stringify(this.metadata)!==JSON.stringify(this.originalMetadata)}},watch:{show:{immediate:!0,handler:function(t){t&&this.files.length>0&&this.loadFields()}}},methods:{t:function(t,e,n){if(n){var a=window.t?window.t(t,e):e;return Object.keys(n).forEach(function(t){a=a.replace("{".concat(t,"}"),n[t])}),a}return window.t?window.t(t,e):e},loadFields:function(){var t=this;return b(p().m(function e(){var n,a,r,s,c,d,u,f,v,m,g,h;return p().w(function(e){for(;;)switch(e.p=e.n){case 0:if(t.loading=!0,e.p=1,n=t.files[0],a=n.path||n.filename||"",r=a.match(/^\/__groupfolders\/(\d+)/),s=null,!r){e.n=2;break}s=r[1],e.n=10;break;case 2:return e.n=3,o.Ay.get((0,l.Jv)("/apps/metavox/api/groupfolders"));case 3:c=e.v,d=c.data,u=y(d),e.p=4,u.s();case 5:if((f=u.n()).done){e.n=7;break}if(v=f.value,!a.includes("/".concat(v.mount_point,"/"))&&!a.startsWith("/".concat(v.mount_point))){e.n=6;break}return s=v.id,e.a(3,7);case 6:e.n=5;break;case 7:e.n=9;break;case 8:e.p=8,g=e.v,u.e(g);case 9:return e.p=9,u.f(),e.f(9);case 10:if(!s){e.n=12;break}return e.n=11,o.Ay.get((0,l.Jv)("/apps/metavox/api/groupfolders/{id}/fields",{id:s}));case 11:m=e.v,t.fields=(m.data||[]).filter(function(t){return"file"===t.field_scope}),e.n=13;break;case 12:t.fields=[];case 13:t.metadata={},t.originalMetadata={},t.fields.forEach(function(e){t.metadata[e.field_name]="",t.originalMetadata[e.field_name]=""}),t.initializeSelectValues(),e.n=15;break;case 14:e.p=14,h=e.v,console.error("Failed to load fields:",h),(0,i.Qg)(t.t("metavox","Failed to load metadata fields"));case 15:return e.p=15,t.loading=!1,e.f(15);case 16:return e.a(2)}},e,null,[[4,8,9,10],[1,14,15,16]])}))()},initializeSelectValues:function(){var t=this;this.selectValues={},this.multiSelectValues={},this.fields.forEach(function(e){"select"===e.field_type?t.selectValues[e.field_name]=null:"multiselect"!==e.field_type&&"multi_select"!==e.field_type||(t.multiSelectValues[e.field_name]=[])}),this.selectKey++},handleFieldUpdate:function(t,e){this.metadata=f(f({},this.metadata),{},v({},t,e));var n=this.fields.find(function(e){return e.field_name===t});n&&("select"===n.field_type?this.selectValues[t]=e||null:"multiselect"!==n.field_type&&"multi_select"!==n.field_type||(this.multiSelectValues[t]=e?e.split(";#"):[]))},save:function(){var t=this;return b(p().m(function e(){var n,a,r,s;return p().w(function(e){for(;;)switch(e.p=e.n){case 0:if(t.saving=!0,e.p=1,n=t.files.map(function(t){return t.fileid}),a={},Object.keys(t.metadata).forEach(function(e){""!==t.metadata[e]&&null!==t.metadata[e]&&(a[e]=t.metadata[e])}),0!==Object.keys(a).length){e.n=2;break}return(0,i.Qg)(t.t("metavox","No metadata values to save")),e.a(2);case 2:return e.n=3,o.Ay.post((0,l.Jv)("/apps/metavox/api/files/bulk-metadata"),{fileIds:n,metadata:a,mergeStrategy:t.mergeStrategy});case 3:(0,i.Te)(t.t("metavox","Metadata saved for {count} files",{count:t.files.length})),t.$emit("saved"),t.close(),e.n=5;break;case 4:e.p=4,s=e.v,console.error("Failed to save metadata:",s),(0,i.Qg)((null===(r=s.response)||void 0===r||null===(r=r.data)||void 0===r?void 0:r.error)||t.t("metavox","Failed to save metadata"));case 5:return e.p=5,t.saving=!1,e.f(5);case 6:return e.a(2)}},e,null,[[1,4,5,6]])}))()},close:function(){this.metadata={},this.originalMetadata={},this.fields=[],this.$emit("close")}}};var _=n(85072),w=n.n(_),S=n(97825),k=n.n(S),O=n(77659),j=n.n(O),A=n(55056),C=n.n(A),P=n(10540),F=n.n(P),M=n(41113),N=n.n(M),E=n(5042),V={};V.styleTagTransform=N(),V.setAttributes=C(),V.insert=j().bind(null,"head"),V.domAPI=k(),V.insertStyleElement=F(),w()(E.A,V),E.A&&E.A.locals&&E.A.locals;const z=(0,n(14486).A)(x,a,[],!1,null,"608d7e9d",null).exports}}]);